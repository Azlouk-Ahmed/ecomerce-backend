
var parse = require('url').parse
var isURL = require('validator').isURL

module.exports = function (href) {
  if (!href) return false

  try {
    href = encodeURI(href)
  } catch (err) {
    return false
  }

  // if relative URLs, assume HTTPs
  if (/^\/\//.test(href)) href = 'https:' + href

  var uri = parse(href)
  if (!uri.protocol || !uri.host || !uri.pathname) return false

  switch (uri.protocol) {
    case 'http:':
    case 'https:':
      break
    default:
      // only support HTTP
      return false
  }

  if (!isURL(href = uri.href)) return false
  return href
}